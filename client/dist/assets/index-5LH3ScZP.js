(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const g=document.getElementById("searchButton"),w=document.getElementById("searchButtonImage"),S=document.getElementById("showFavoritesButton"),O=document.getElementById("favoritesButton"),l=document.getElementById("resultList"),c=document.getElementById("resultListContainer"),p=document.getElementById("darkmodeButton"),x=document.getElementById("searchInput"),v=document.getElementById("platform"),f=document.getElementById("genre"),C=document.getElementById("gamemode"),u=document.getElementById("sort"),N=`
            <svg fill="#112D4E" height="25px" width="25px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                viewBox="0 0 482.207 482.207" xml:space="preserve">
            <polygon points="482.207,186.973 322.508,153.269 241.104,11.803 159.699,153.269 0,186.973 109.388,308.108 92.094,470.404 
                241.104,403.803 390.113,470.404 372.818,308.108 "/>
            </svg>
            `,F=`
            <svg fill="#112D4E" height="25px" width="25px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                viewBox="0 0 482.207 482.207" xml:space="preserve">
            <path d="M482.207,186.973l-159.699-33.705L241.104,11.803l-81.404,141.465L0,186.973l109.388,121.134L92.094,470.404l149.01-66.6
                l149.01,66.6l-17.294-162.296L482.207,186.973z M241.104,370.943l-113.654,50.798l13.191-123.788l-83.433-92.393l121.807-25.707
                l62.09-107.9l62.09,107.9L425,205.561l-83.433,92.393l13.191,123.788L241.104,370.943z"/>
            </svg>
            `,$=()=>{const a=document.createElement("div");new IntersectionObserver(t=>{t.forEach(o=>{o.isIntersecting&&d.loadMoreGames()})}).observe(a),c.appendChild(a)};class M{constructor(e,t,o,n,s,r,i){this.id=e,this.name=t,this._cover="",this.cover=o,this.genres=n,this.gamemodes=s,this.platforms=r,this._storyline="",this.storyline=i,this.favorite=this.setFavorite()}get cover(){return this._cover}set cover(e){this._cover=e?`https://images.igdb.com/igdb/image/upload/t_cover_big/${e.image_id}.jpg`:"https://www.vglist.co/packs/media/images/no-cover-369ad8f0ea82dde5923c942ba1a26482.png"}get storyline(){return this._storyline}set storyline(e){this._storyline=e||""}getList(e){return e?`<ul>${e.map(t=>`<li>${t.name}</li>`).join("")}</ul>`:""}getGameCardList(e){return e?`${e.map(t=>t.name).join(", ")}`:""}setFavorite(){return JSON.parse(localStorage.getItem("favorites")||"[]").includes(this.id)}toggleFavorite(){let e=JSON.parse(localStorage.getItem("favorites"));if(e==null&&(e=[]),this.favorite){const t=e.indexOf(this.id);e.splice(t,1),this.favorite=!1}else e.push(this.id),this.favorite=!0;localStorage.setItem("favorites",JSON.stringify(e))}getFavoriteIcon(){return this.favorite?N:F}createCard(){const e=document.createElement("div");e.className="gameCard";const t=document.createElement("div");t.className="coverImageContainer";const o=document.createElement("img");o.src=this.cover,o.alt=`${this.name} cover image`,o.className="coverImage";const n=document.createElement("div");n.className="blurredBackground",n.style.backgroundImage=`url('${this.cover}')`,t.appendChild(n),t.appendChild(o);const s=document.createElement("div");s.className="favoriteIcon",s.innerHTML=this.getFavoriteIcon(),s.addEventListener("click",h=>{h.stopPropagation(),this.toggleFavorite(),s.innerHTML=this.getFavoriteIcon()});const r=document.createElement("div");r.className="gameInfo";const i=document.createElement("h1");i.textContent=this.name,r.appendChild(i);const m=document.createElement("p");return m.textContent=this.getGameCardList(this.platforms),r.appendChild(m),e.appendChild(t),e.appendChild(s),e.appendChild(r),e.addEventListener("click",()=>this.showGamePage()),e}showGamePage(){const e=document.createElement("article");e.className="gamePage";const t=document.createElement("a");t.className="returnLink",t.textContent="< back",t.addEventListener("click",()=>{d.showGames(),$()});const o=document.createElement("div");o.className="favoriteIcon",o.innerHTML=this.getFavoriteIcon(),o.addEventListener("click",()=>{this.toggleFavorite(),o.innerHTML=this.getFavoriteIcon()});const n=document.createElement("h1");n.textContent=this.name;const s=document.createElement("div");s.className="coverAndInfoContainer";const r=document.createElement("img");r.src=this.cover,r.alt=`${this.name} cover image`,r.className="gamePageCoverImage",s.appendChild(r);const i=document.createElement("div");i.className="gamePageInfo";const m=document.createElement("div");m.innerHTML=`
        <h3>Genres:</h3>
        ${this.getList(this.genres)}
        `;const h=document.createElement("div");h.innerHTML=`
        <h3>Game modes:</h3>
        ${this.getList(this.gamemodes)}
        `;const I=document.createElement("div");I.innerHTML=`
        <h3>Platforms:</h3>
        ${this.getList(this.platforms)}
        `,i.appendChild(m),i.appendChild(h),i.appendChild(I),s.appendChild(i);const y=document.createElement("p");y.textContent=this.storyline,e.appendChild(t),e.appendChild(o),e.appendChild(n),e.appendChild(s),e.appendChild(y),l.innerHTML="",l.appendChild(e),c.removeChild(c.lastChild)}}const T=a=>{c.removeChild(c.lastChild);for(let e of a){const t=new M(e.id,e.name,e.cover,e.genres,e.game_modes,e.platforms,e.storyline);d.addGame(t),l.appendChild(t.createCard())}a.length===100&&$()};class P{constructor(e,t,o,n){this.search=e,this.filters=t,this.offset=o,this.sort=n,this.games=[]}addGame(e){this.games.push(e)}sortGames(e){switch(this.sort=e,e){case"asc":this.games.sort((t,o)=>t.name.localeCompare(o.name));break;case"desc":this.games.sort((t,o)=>o.name.localeCompare(t.name));break}this.showGames()}showGames(){l.innerHTML="";for(let e of this.games)l.appendChild(e.createCard())}loadMoreGames(){this.offset+=100,L(this.search,this.filters,this.offset,this.sort)}}let d;const L=async(a,e,t,o)=>{t===0?(w.src="./src/assets/clock.svg",g.setAttribute("disabled",""),l.innerHTML="",d=new P(a,e,0,o)):c.removeChild(c.lastChild);const n=document.createElement("div");return n.textContent="Loading...",c.appendChild(n),fetch(`http://localhost:8080/games?search=${a}&offset=${t}&sort=${o}`,{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(e)}).then(s=>s.json()).then(s=>T(s)).catch(s=>console.error(s)).finally(()=>{w.src="./src/assets/search.svg",g.removeAttribute("disabled")})},E=(a,e,t)=>{fetch(`http://localhost:8080/lists/${a}?limit=${e}`,{method:"POST",headers:{"Content-type":"application/json"}}).then(o=>o.json()).then(o=>{for(let n of o){const s=document.createElement("option");s.textContent=n.name,s.value=n.name,t.appendChild(s)}}).catch(o=>console.error(o))},_=()=>{document.body.classList.toggle("darkmode"),document.body.classList.contains("darkmode")?localStorage.setItem("darkmode",!0):localStorage.setItem("darkmode",!1),G()},H=()=>{localStorage.getItem("darkmode")==="true"&&(document.body.className="darkmode",G())},G=()=>{localStorage.getItem("darkmode")==="true"?p.firstChild.src="./src/assets/sun.svg":p.firstChild.src="./src/assets/moon.svg"},D=()=>{let a=JSON.parse(localStorage.getItem("favorites")||"[]"),e={id:a?a.join(", "):""};L("",e,0,u.value)};let k,B,b=0;E("platforms",220,v);E("genres",25,f);E("game_modes",6,C);O.innerHTML=N;S.addEventListener("click",()=>D());p.addEventListener("click",()=>_());window.addEventListener("load",()=>H());g.addEventListener("click",()=>{k=x.value.trim(),B={"platforms.name":v.value?`"${v.value}"`:"","genres.name":f.value?`"${f.value}"`:"","game_modes.name":C.value?`"${C.value}"`:""},b=0,L(k,B,b,u.value)});x.addEventListener("keypress",a=>{a.key==="Enter"&&(a.preventDefault(),g.click())});u.addEventListener("change",()=>{d&&d.sortGames(u.value)});
